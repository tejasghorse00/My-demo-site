import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBgpHx6jrlT9JMd2il2QP2XGmYJXjuD7NQ",
  authDomain: "super-authentication-c6e56.firebaseapp.com",
  projectId: "super-authentication-c6e56",
  storageBucket: "super-authentication-c6e56.appspot.com",
  messagingSenderId: "917531865165",
  appId: "1:917531865165:web:37d97f74a5ec763929ac04",
  measurementId: "G-22ZZYQGJMH"
};

// Init
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

// DOM
const statusEl = document.getElementById("status");
const errorEl = document.getElementById("error");

// Signup
const signupBtn = document.getElementById("signupBtn");
if(signupBtn){
  signupBtn.addEventListener("click", () => {
    const email = document.getElementById("signupEmail").value;
    const password = document.getElementById("signupPassword").value;
    createUserWithEmailAndPassword(auth, email, password)
      .then(() => window.location.href = "home.html")
      .catch(err => errorEl.innerText = err.message);
  });
}

// Login
const loginBtn = document.getElementById("loginBtn");
if(loginBtn){
  loginBtn.addEventListener("click", () => {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;
    signInWithEmailAndPassword(auth, email, password)
      .then(() => window.location.href = "home.html")
      .catch(err => errorEl.innerText = err.message);
  });
}

// Google Login
const googleBtn = document.getElementById("googleBtn");
if(googleBtn){
  googleBtn.addEventListener("click", () => {
    signInWithPopup(auth, provider)
      .then(() => window.location.href = "home.html")
      .catch(err => errorEl.innerText = err.message);
  });
}

// Logout
const logoutBtn = document.getElementById("logoutBtn");
if(logoutBtn){
  logoutBtn.addEventListener("click", () => {
    signOut(auth).then(() => window.location.href = "index.html");
  });
}

// Auth state check
onAuthStateChanged(auth, (user) => {
  if(!user && window.location.pathname.includes("home.html")){
    window.location.href = "index.html";
  }
});